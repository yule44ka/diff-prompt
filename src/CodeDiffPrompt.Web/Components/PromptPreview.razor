@using System.Text

<div class="prompt-preview-container">
    <div class="prompt-header">
        <h3>Prompt Preview</h3>
        @if (Editable)
        {
            <button class="btn btn-sm btn-secondary" @onclick="ResetToDefault">
                Reset to Default
            </button>
        }
    </div>
    
    <div class="prompt-content">
        @if (Editable)
        {
            <textarea 
                class="form-control prompt-textarea" 
                @bind="EditablePrompt" 
                @bind:event="oninput"
                rows="20"></textarea>
        }
        else
        {
            <pre class="prompt-display">@Prompt</pre>
        }
    </div>
</div>

@code {
    [Parameter]
    public string Prompt { get; set; } = "";

    [Parameter]
    public bool Editable { get; set; } = false;

    [Parameter]
    public EventCallback<string> OnPromptChanged { get; set; }

    private string _editablePrompt = "";

    private string EditablePrompt
    {
        get => _editablePrompt;
        set
        {
            _editablePrompt = value;
            OnPromptChanged.InvokeAsync(value);
        }
    }

    protected override void OnParametersSet()
    {
        if (_editablePrompt != Prompt)
        {
            _editablePrompt = Prompt;
        }
    }

    private async Task ResetToDefault()
    {
        // This will be handled by the parent component
        await OnPromptChanged.InvokeAsync("");
    }
}


